#!/usr/bin/env node

/**
 * Panther Server Manager bootstrap
 * TODO:
 * - Check config/servers.json to ensure that each entry
 *   has atleast the minumum settings
 * - Check config/server.json to ensure there are no duplicate
 *   aliases for server-ids
 **/

//load required modules
var fs = require('fs');

if(process.send) {
    //if we are forked, we need to supress stdout/err
    var nullStream = fs.createWriteStream('/dev/null'),
    getStream = function() { return nullStream; };

    process.__defineGetter__('stdout', getStream);
    process.__defineGetter__('stderr', getStream);
}

var psm = require('../lib/psm');
psm.getManager(function(man) {
    psm.manager = man;
    psm.cli.start();
});

/*
var Cli = require('../lib/cli').Cli,
Api = require('../lib/api').Api,
Psm = require('../lib/psm').Psm,
Logger = require('../lib/logger').Logger,
config = require('../config/config.json'),
servers = require('../config/servers.json');

//initialize PSM module and
//the CLI and API modules
var logger = new Logger(),
psm = new Psm(servers, logger),
api = new Api(psm, logger);

psm.on('ready', function() {
    if(config.api.enabled) api.start();

    cli = new Cli(psm, api, logger);

    cli.start();
});
*/